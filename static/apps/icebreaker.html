<!DOCTYPE html>
<html lang="en">
<head>
    <title>Exhibit B: The Icebreaker</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <style>
        body { margin: 0; background-color: #111; overflow: hidden; font-family: sans-serif; }
        #info { position: absolute; bottom: 20px; left: 20px; color: white; opacity: 0.7; pointer-events: none; }
    </style>
    
	
   <script type="importmap">
   {
       "imports": {
           "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
           "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/",
           "xrblocks": "https://cdn.jsdelivr.net/gh/google/xrblocks@build/dist/xrblocks.js"
       }
   }
   </script>
	

</head>
<body>

    <div id="info">
        <h3>Exhibit B</h3>
        <p>Drag to rotate • Scroll to zoom • Enter VR/AR below</p>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import * as xb from 'xrblocks';

        // 1. Define our custom Icebreaker Script
        class IcebreakerScene extends xb.App {
            async init() {
                // Setup lights for a gallery feel
                const ambient = new THREE.HemisphereLight(0xffffff, 0x444444, 2);
                this.add(ambient);
                
                const spot = new THREE.SpotLight(0xffaa00, 10);
                spot.position.set(2, 5, 2);
                this.add(spot);

                // 2. Load the "Icebreaker" Model
                // We use a high-quality robot avatar to represent the Gemini agent
                const gltfLoader = new THREE.GLTFLoader();
                const modelUrl = 'https://modelviewer.dev/shared-assets/models/RobotExpressive.glb';
                
                try {
                    const gltf = await gltfLoader.loadAsync(modelUrl);
                    const model = gltf.scene;
                    model.position.set(0, -1, -2); // Stand in front of user
                    model.scale.set(0.5, 0.5, 0.5);
                    this.add(model);

                    // Add a simple idle animation if available
                    if (gltf.animations.length > 0) {
                        this.mixer = new THREE.AnimationMixer(model);
                        // Play the 'Idle' or 'Wave' animation
                        const action = this.mixer.clipAction(gltf.animations[0]); 
                        action.play();
                    }
                } catch (e) {
                    console.error("Could not load model:", e);
                }

                // 3. Create Floating Artworks (The "Mona Lisa" Effect)
                const artUrls = [
                    'https://images.unsplash.com/photo-1579783902614-a3fb39279c23?auto=format&fit=crop&w=600&q=80', // Abstract
                    'https://images.unsplash.com/photo-1547891654-e66ed7ebb968?auto=format&fit=crop&w=600&q=80', // Texture
                    'https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?auto=format&fit=crop&w=600&q=80'  // Oil Paint
                ];

                artUrls.forEach((url, i) => {
                    const texture = new THREE.TextureLoader().load(url);
                    const geometry = new THREE.PlaneGeometry(1, 1.4); // Portrait aspect
                    const material = new THREE.MeshBasicMaterial({ 
                        map: texture, 
                        side: THREE.DoubleSide,
                        transparent: true,
                        opacity: 0.9
                    });
                    
                    const artPanel = new THREE.Mesh(geometry, material);
                    
                    // Position them in a semi-circle around the user
                    const angle = (i - 1) * 0.8; // Spread angles: -0.8, 0, +0.8
                    const radius = 2.5;
                    
                    artPanel.position.set(
                        Math.sin(angle) * radius, 
                        0.5 + (Math.sin(i * 2) * 0.2), // Slight height variation
                        Math.cos(angle) * -radius - 1
                    );
                    
                    artPanel.lookAt(0, 0, 0); // Face the user
                    
                    // Add a slow "floating" animation property we can use in tick()
                    artPanel.userData = { 
                        initialY: artPanel.position.y, 
                        speed: 0.001 + (i * 0.0005),
                        offset: i * 10
                    };
                    
                    this.artPanels = this.artPanels || [];
                    this.artPanels.push(artPanel);
                    this.add(artPanel);
                });
            }

            tick(time, delta) {
                // Update animations
                if (this.mixer) this.mixer.update(delta);

                // Animate floating art
                if (this.artPanels) {
                    this.artPanels.forEach(panel => {
                        panel.position.y = panel.userData.initialY + Math.sin(time * 0.001 + panel.userData.offset) * 0.1;
                    });
                }
            }
        }

        // Start the XR Blocks App
        new IcebreakerScene().start();
    </script>
</body>
</html>