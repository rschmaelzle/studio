<!DOCTYPE html>
<html lang="en">
<head>
    <title>Exhibit B: The Icebreaker</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <style>
        body { margin: 0; background-color: #111; overflow: hidden; font-family: sans-serif; }
        #info { position: absolute; bottom: 20px; left: 20px; color: white; opacity: 0.7; pointer-events: none; z-index: 999; }
    </style>
    
    <!-- Import Map: Using Three.js 0.182.0 (compatible with XR Blocks) -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.182.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.182.0/examples/jsm/",
            "xrblocks": "https://cdn.jsdelivr.net/gh/google/xrblocks@build/xrblocks.js",
            "xrblocks/addons/": "https://cdn.jsdelivr.net/gh/google/xrblocks@build/addons/"
        }
    }
    </script>
</head>
<body>

    <div id="info">
        <h3>Exhibit B</h3>
        <p>Drag to rotate • Scroll to zoom • Enter VR/AR below</p>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import * as xb from 'xrblocks';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

        // 1. Define the Experience
        class IcebreakerScene extends xb.Script {
            
            async init() {
                console.log("Exhibit B: Initializing...");
                
                // Add Lights
                const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 3);
                this.add(hemiLight);
                
                const dirLight = new THREE.DirectionalLight(0xffffff, 2);
                dirLight.position.set(0, 5, 5);
                this.add(dirLight);

                // Load Robot Model
                const loader = new GLTFLoader();
                const modelUrl = 'https://modelviewer.dev/shared-assets/models/RobotExpressive.glb';
                
                loader.load(modelUrl, (gltf) => {
                    console.log("Exhibit B: Model Loaded");
                    const model = gltf.scene;
                    model.position.set(0, -1, -2);
                    model.scale.set(0.5, 0.5, 0.5);
                    this.add(model);

                    if (gltf.animations.length > 0) {
                        this.mixer = new THREE.AnimationMixer(model);
                        this.mixer.clipAction(gltf.animations[0]).play();
                    }
                });

                // Create Floating Art Gallery
                this.createGallery();
            }

            createGallery() {
                const artUrls = [
                    'https://images.unsplash.com/photo-1579783902614-a3fb39279c23?auto=format&fit=crop&w=600&q=80',
                    'https://images.unsplash.com/photo-1604871000636-074fa5117945?auto=format&fit=crop&w=600&q=80',
                    'https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?auto=format&fit=crop&w=600&q=80'
                ];

                this.artPanels = [];
                const loader = new THREE.TextureLoader();

                artUrls.forEach((url, i) => {
                    loader.load(url, (texture) => {
                        const geometry = new THREE.PlaneGeometry(1, 1.4);
                        const material = new THREE.MeshBasicMaterial({ map: texture, side: THREE.DoubleSide });
                        const panel = new THREE.Mesh(geometry, material);

                        // Position: Semi-circle
                        const angle = (i - 1) * 0.8;
                        const radius = 2.5;
                        
                        panel.position.set(Math.sin(angle) * radius, 0.5, Math.cos(angle) * -radius - 1);
                        panel.lookAt(0, 0, 0);
                        
                        // Custom data for animation
                        panel.userData = { 
                            yStart: panel.position.y, 
                            speed: 0.001 + (i * 0.0005), 
                            offset: i * 10 
                        };

                        this.artPanels.push(panel);
                        this.add(panel);
                    });
                });
            }

            tick(time, delta) {
                // Update Robot Animation
                if (this.mixer) this.mixer.update(delta);

                // Update Floating Art (Bobbing Effect)
                if (this.artPanels) {
                    this.artPanels.forEach(panel => {
                        panel.position.y = panel.userData.yStart + Math.sin(time * 0.001 + panel.userData.offset) * 0.1;
                    });
                }
            }
        }

        // 2. Register and Start the Engine
        // This was the missing step: We must add the script to 'xb' and then call init()
        xb.add(new IcebreakerScene());
        xb.init(); 

    </script>
</body>
</html>