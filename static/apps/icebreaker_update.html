<!DOCTYPE html>
<html lang="en">
<head>
    <title>Exhibit B: Floating Gallery</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    
    <!-- 1. CRITICAL: This CSS makes the 'Enter XR' button visible and styled -->
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/google/xrblocks@build/samples/main.css" />

    <style>
        /* Simple styling for the overlay info text */
        #info {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            opacity: 0.8;
            pointer-events: none;
            z-index: 999;
            text-align: center;
            font-family: sans-serif;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 8px;
        }
    </style>
    
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.182.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.182.0/examples/jsm/",
            "xrblocks": "https://cdn.jsdelivr.net/gh/google/xrblocks@build/xrblocks.js",
            "xrblocks/addons/": "https://cdn.jsdelivr.net/gh/google/xrblocks@build/addons/"
        }
    }
    </script>
</head>
<body>

    <div id="info">
        <h3>Exhibit B: Mixed Reality</h3>
        <p>Enter AR to see the art float in your room</p>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import * as xb from 'xrblocks';

        class FloatingGallery extends xb.Script {
            
            async init() {
                // 1. Setup Environment
                // Desktop: Blue sphere. Mobile AR: Passthrough (Camera).
                this.setupEnvironment();

                // 2. Setup Gallery
                // We use reliable placeholder images.
                this.createGallery();
            }

            setupEnvironment() {
                // Lights
                const dirLight = new THREE.DirectionalLight(0xffffff, 2);
                dirLight.position.set(0, 5, 5);
                this.add(dirLight);
                this.add(new THREE.AmbientLight(0xffffff, 1));

                // Blue Background Sphere (Visible ONLY on Desktop/VR)
                // We will hide this in AR so you see the real world.
                const bgGeo = new THREE.SphereGeometry(10, 32, 32);
                const bgMat = new THREE.MeshBasicMaterial({ 
                    color: 0x112244, 
                    side: THREE.BackSide 
                });
                this.bgSphere = new THREE.Mesh(bgGeo, bgMat);
                this.add(this.bgSphere);
            }

            createGallery() {
                const artUrls = [
                    'https://images.unsplash.com/photo-1579783902614-a3fb39279c23?auto=format&fit=crop&w=600&q=80', // Blue Abstract
                    'https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?auto=format&fit=crop&w=600&q=80'  // Orange Fluid
                ];

                this.artPanels = [];
                const loader = new THREE.TextureLoader();

                artUrls.forEach((url, i) => {
                    loader.load(url, (texture) => {
                        const geometry = new THREE.PlaneGeometry(1, 1.4);
                        const material = new THREE.MeshBasicMaterial({ map: texture, side: THREE.DoubleSide });
                        const panel = new THREE.Mesh(geometry, material);

                        // Position left (-1) and right (+1)
                        const xPos = (i === 0) ? -0.8 : 0.8;
                        panel.position.set(xPos, 1.5, -2); // 1.5m high, 2m away
                        panel.lookAt(0, 1.5, 0);

                        // Animation Data
                        panel.userData = { 
                            yStart: 1.5, 
                            offset: i * 100 
                        };

                        this.artPanels.push(panel);
                        this.add(panel);
                    });
                });
            }

            tick(time, delta) {
                // 1. Floating Animation
                if (this.artPanels) {
                    this.artPanels.forEach(panel => {
                        panel.position.y = panel.userData.yStart + Math.sin(time * 0.001 + panel.userData.offset) * 0.05;
                    });
                }

                // 2. AR Passthrough Logic
                // If we are in AR, hide the blue sphere. If on desktop, show it.
                if (this.bgSphere) {
                    const isAR = xb.renderer.xr.isPresenting;
                    this.bgSphere.visible = !isAR; 
                }
            }
        }

        // Initialize XR Blocks
        xb.add(new FloatingGallery());
        xb.init(); 

    </script>
</body>
</html>