<!DOCTYPE html>
<html lang="en">
<head>
    <title>Exhibit B: Floating Gallery</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    
    <!-- CRITICAL FIX: Use the 'main' branch for CSS so the 'Enter AR' button appears -->
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/google/xrblocks@main/samples/main.css" />

    <style>
        /* Optional: Custom styling for your info text */
        #info {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            color: white;
            pointer-events: none;
            z-index: 999;
            font-family: sans-serif;
            text-shadow: 1px 1px 2px black;
        }
    </style>
    
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.182.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.182.0/examples/jsm/",
            "xrblocks": "https://cdn.jsdelivr.net/gh/google/xrblocks@build/xrblocks.js",
            "xrblocks/addons/": "https://cdn.jsdelivr.net/gh/google/xrblocks@build/addons/"
        }
    }
    </script>
</head>
<body>

    <div id="info">
        <h3>Floating Gallery</h3>
        <p>Press "Enter AR" below to view in your room</p>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import * as xb from 'xrblocks';

        class GalleryScene extends xb.Script {
            
            async init() {
                // 1. Add Lights
                const light = new THREE.DirectionalLight(0xffffff, 3);
                light.position.set(0, 5, 5);
                this.add(light);
                this.add(new THREE.AmbientLight(0xffffff, 1));

                // 2. Create Background (Blue Sphere)
                // We keep a reference to this so we can hide it in AR
                const bgGeo = new THREE.SphereGeometry(10, 32, 32);
                const bgMat = new THREE.MeshBasicMaterial({ 
                    color: 0x224488, 
                    side: THREE.BackSide 
                });
                this.bgSphere = new THREE.Mesh(bgGeo, bgMat);
                this.add(this.bgSphere);

                // 3. Create Art Panels
                this.createArt();
            }

            createArt() {
                // Using generated placeholder images to guarantee they load
                const imageUrls = [
                    'https://placehold.co/600x800/orange/white.png?text=Art+1',
                    'https://placehold.co/600x800/purple/white.png?text=Art+2'
                ];

                this.panels = [];
                const loader = new THREE.TextureLoader();

                imageUrls.forEach((url, index) => {
                    loader.load(url, (texture) => {
                        const geometry = new THREE.PlaneGeometry(0.6, 0.8);
                        const material = new THREE.MeshStandardMaterial({ map: texture, side: THREE.DoubleSide });
                        const panel = new THREE.Mesh(geometry, material);

                        // Position them roughly at eye level (1.5m)
                        // One slightly left, one slightly right
                        const xPos = index === 0 ? -0.5 : 0.5;
                        panel.position.set(xPos, 1.5, -1.5);
                        
                        // Slightly rotate them to face center
                        panel.rotation.y = index === 0 ? 0.2 : -0.2;

                        // Save initial Y for animation
                        panel.userData = { startY: 1.5, offset: index * 10 };
                        
                        this.panels.push(panel);
                        this.add(panel);
                    });
                });
            }

            tick(time, delta) {
                // 1. Animate Panels (Gentle bobbing)
                if (this.panels) {
                    this.panels.forEach(panel => {
                        panel.position.y = panel.userData.startY + Math.sin(time * 0.002 + panel.userData.offset) * 0.05;
                    });
                }

                // 2. AR Logic: Hide Blue Sphere if in AR
                // xb.renderer.xr.isPresenting returns true if we are in AR/VR
                if (xb.renderer.xr.isPresenting) {
                    this.bgSphere.visible = false;
                } else {
                    this.bgSphere.visible = true;
                }
            }
        }

        // Initialize XR Blocks
        document.addEventListener('DOMContentLoaded', function () {
            xb.add(new GalleryScene());
            xb.init(new xb.Options()); // This triggers the button creation
        });

    </script>
</body>
</html>